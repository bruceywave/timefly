define("sarike/timefly/1.0.0/timefly",["sarike/bootstrap/2.3.2/bootstrap","$","jquery-plugin/form/3.36.0/form","sarike/utils/1.0.0/utils","gallery/backbone/1.0.0/backbone","gallery/underscore/1.4.4/underscore","./index/index","sarike/libs/1.0.0/libs","sarike/common/1.0.0/common","./index/templates/todo_item.tpl","./index/templates/index_content.tpl","./home/home","./home/templates/setting_form.tpl","./home/templates/password_reset_form.tpl","./home/templates/todo_item.tpl","./home/templates/add_complete_modal.tpl"],function(a){a("sarike/bootstrap/2.3.2/bootstrap"),a("jquery-plugin/form/3.36.0/form"),a("sarike/utils/1.0.0/utils");var b=a("$"),c=a("gallery/backbone/1.0.0/backbone");b(function(){b.get("me",function(d){var e=new c.Router,f=new c.Model(d.data.user),g={header:b("header"),sideBar:b("#sidebar"),content:b("#content"),footer:b("footer"),user:f,router:e};g.user.on("login-event",function(a){g.user=a.user}),a("./index/index").init(g),a("./home/home").init(g),c.history.start()})})}),define("sarike/timefly/1.0.0/index/index",["sarike/libs/1.0.0/libs","$","gallery/underscore/1.4.4/underscore","sarike/common/1.0.0/common"],function(a,b){a("sarike/libs/1.0.0/libs"),a("$");var c=a("gallery/underscore/1.4.4/underscore"),d=a("sarike/common/1.0.0/common"),e=d.Collections.BaseCollection.extend({url:"account/passionate_users"}),f=d.Collections.BaseCollection.extend({url:"todo/latest_todos"}),g=d.Views.Item.extend({className:"media",template:c.template(a("sarike/timefly/1.0.0/index/templates/todo_item.tpl")),render:function(){return this.$el.html(this.template(this.model.toJSON())),this}}),h=d.Views.Content.extend({title:"最新计划",sub_title:"时光飞逝网友们最近发布的最新计划，一起来为他们加油吧",template:c.template(a("sarike/timefly/1.0.0/index/templates/index_content.tpl")),itemContainer:".media-list",ItemView:g});b.init=function(a){a.router.route("","index",function(){var b=[new d.Box.UserBox({collection:new e}),new d.Box.AboutBox],c=new h({collection:new f});a.user.set("self_home",!1),a.user.set("at_index_page",!0),d.init(a,{sideBarBoxes:b,content:c})})}}),define("sarike/timefly/1.0.0/index/templates/todo_item.tpl",[],'  <a class="pull-left" href="./#<%=user.username %>">\n    <img class="media-object img-rounded"\n         src="http://www.gravatar.com/avatar/<%=user.avatar_hash %>?d=identicon">\n  </a>\n  <div class="media-body" style="font-size:14px;line-height: 20px;">\n    <h4 class="media-heading"><%=todo_name %></h4>\n        该计划由 <a href="./#<%=user.username %>"><%=user.nickname || user.username %></a>\n        开始于 <%=new Date(todo_start).format("yyyy-MM-dd") %> ，\n        计划在 <%=new Date(todo_end).format("yyyy-MM-dd") %> 完成！\n        <br>\n        <%=todo_description %>\n  </div>'),define("sarike/timefly/1.0.0/index/templates/index_content.tpl",[],'<ul class="media-list">\n</ul>'),define("sarike/timefly/1.0.0/home/home",["sarike/libs/1.0.0/libs","$","gallery/underscore/1.4.4/underscore","gallery/backbone/1.0.0/backbone","sarike/common/1.0.0/common"],function(a,b){var c=a("sarike/libs/1.0.0/libs"),d=a("$"),e=a("gallery/underscore/1.4.4/underscore"),f=a("gallery/backbone/1.0.0/backbone"),g=a("sarike/common/1.0.0/common"),h=a("sarike/timefly/1.0.0/home/templates/setting_form.tpl"),i=a("sarike/timefly/1.0.0/home/templates/password_reset_form.tpl"),j=g.Collections.BaseCollection.extend({url:"account/my_friends"}),k=g.Collections.BaseCollection.extend({url:"todo/my_todos"});b.init=function(b){var l=g.Views.Item.extend({template:e.template(a("sarike/timefly/1.0.0/home/templates/todo_item.tpl")),events:{"click a.mark-complete":"markComplete","click a.delete-todo":"deleteTodo","click a.change-visible":"changeVisible","click a.add-new-complete":"addNewComplete"},dealTodo:function(a,b,e){var f=this.model.get("todo_id");c.Noty.Confirm({text:e,ok:function(e){e.close(),d.get(a,{todo_id:f},function(a){b&&"function"==typeof b&&b(a.data),c.Noty.NotyWithRes(a)})}})},markComplete:function(){var a=this.model.get("todo_is_completed")?"确定要撤销已完成状态吗？":"确定要标记为完成吗？";this.dealTodo("/todo/mark_complete",d.proxy(function(a){this.model.set("todo_is_completed",a.todo_is_completed)},this),a)},deleteTodo:function(){this.dealTodo("/todo/delete_todo",d.proxy(function(){this.$el.fadeOut()},this),"确定要删除吗？")},changeVisible:function(){var a=this.model.get("todo_visible")?"确定要设为私密计划吗？":"确定要公开该计划吗？";this.dealTodo("/todo/change_visible",d.proxy(function(a){this.model.set("todo_visible",a.todo_visible)},this),a)},addNewComplete:function(){var b=this,f=c.JQueryUI.Dialog.extend({template:e.template(a("sarike/timefly/1.0.0/home/templates/add_complete_modal.tpl")),ok:function(){this.$("#ac-form").submit()},extraRender:function(){var a=this.$("#ac-form"),c=this;a.validate({errorClass:"error",submitHandler:function(a){d(a).ajaxSubmit(d.proxy(function(a){this.close(),b.model.get("achievement_list").splice(0,0,a.data),b.render()},c))},ignore:"input[type='checkbox']",errorPlacement:function(a,b){b.prev().hide(),b.prev().after(a)},success:function(a){a.prev().show(),a.remove()},rules:{ac_name:{required:!0,maxlength:20},ac_description:{required:!0,maxlength:100}},messages:{ac_name:{required:"不响亮不要紧，可不能不填哟",maxlength:jQuery.format("够响亮了，不过不能多于{0}个字符")},ac_description:{required:"你到底是完成了什么呢？",maxlength:jQuery.format("不过不能多于{0}个字符")}}})}}),g=new f({contentCollection:this.options.collection,todo_id:this.model.get("todo_id")});g.open({height:335,width:300,modal:!0,title:"记录新的突破",resizable:!1})},render:function(){return this.$el.html(this.template({todo:this.model.toJSON(),user:b.user.toJSON()})),this}}),m=g.Views.Content.extend({className:"",has_title:!1,ItemView:l}),n=g.Views.ObjectContent.extend({title:"个人描述",sub_title:"写下自己的奋斗宣言",template:e.template(h),events:{"click #updateProfile":"updateProfile"},updateProfile:function(){var a=this.$("#id_description").val();d.post("/account/update_profile",{desc:a},function(a){c.Noty.NotyWithRes(a)})}}),o=g.Views.ObjectContent.extend({title:"密码重置",sub_title:"修改您的账号密码",template:e.template(i),events:{"click #resetPwd":"resetPwd"},resetPwd:function(){var a=this.$("#id_old_password").val(),b=this.$("#id_new_password").val(),e=this.$("#id_new_password_confirm").val();d.post("/account/reset_password",{old_password:a,new_password:b,new_password_confirm:e},function(a){c.Noty.NotyWithRes(a)})}}),p=g.Box.SideNavBox.extend({side_nav_list:[{id:"doing",caption:"正在努力的计划",active:!0},{id:"completed",caption:"已经完成的计划"},{id:"failed",caption:"半途而废的计划"}],action:function(a){var b=a.data("id");this.options.content.refresh({flag:b})}}),q=g.Box.SideNavBox.extend({side_nav_list:[{active:!0,id:"profile",caption:"个人资料"},{id:"pwd_reset",caption:"密码设置"}],action:function(a){var c=a.data("id"),d=this.options.content;"profile"==c&&b.content.html(d.render().el),"pwd_reset"==c&&b.content.html((new o).render().el)}});b.router.route(":username(/:position)","home",function(a,c){d.get("/"+a,function(a){var e=a.data.owner,h=b.user.get("username")==e.username;b.user.set("self_home",h),b.user.set("at_index_page",!1);var i=null,l=null;c&&"setting"==c?(console.info(b.user),i=new n({data:{user:b.user.toJSON()}}),l=[new g.Box.UserProfileBox({model:new f.Model(e)}),new q({content:i}),new g.Box.AboutBox]):(i=new m({data:{user:b.user},collection:new k}),l=[new g.Box.UserProfileBox({model:new f.Model(e)}),new p({content:i}),new g.Box.UserBox({collection:new j}),new g.Box.AboutBox]),g.init(b,{sideBarBoxes:l,content:i}),d(document).tooltip()})})}}),define("sarike/timefly/1.0.0/home/templates/setting_form.tpl",[],'    <div class="control-group">\n        <div class="controls">\n            <textarea cols="40" class="input-block-level" id="id_description" rows="5"><%=user.description %></textarea>\n        </div>\n    </div>\n    <div class="control-group">\n        <div class="controls">\n            <button id="updateProfile" class="btn btn-info">保存更改</button>\n        </div>\n    </div>'),define("sarike/timefly/1.0.0/home/templates/password_reset_form.tpl",[],'<div class="form-horizontal text-left" method="post">\n        <div class="control-group">\n            <label class="control-label" for="inputEmail">原始密码</label>\n            <div class="controls">\n                <input id="id_old_password" maxlength="30" name="old_password" size="30" type="password">\n                <span class="inline label label-important"></span>\n                <!-- <span class="help-block"><a href="#">你竟然把密码给忘记了？</a></span> -->\n            </div>\n        </div>\n        <div class="control-group">\n            <label class="control-label" for="inputEmail">新密码</label>\n            <div class="controls">\n            <input id="id_new_password" maxlength="30" name="new_password" size="30" type="password">\n            <span class="inline label label-important"></span>\n            </div>\n        </div>\n        <div class="control-group">\n            <label class="control-label" for="inputEmail">确认密码</label>\n            <div class="controls">\n                <input id="id_new_password_confirm" maxlength="30" name="new_password_confirm" size="30" type="password">\n                <span class="inline label label-important"></span>\n            </div>\n        </div>\n        <div class="control-group">\n            <div class="controls">\n                <button id="resetPwd" class="btn btn-info">保存更改</button>\n            </div>\n        </div>\n    </div>'),define("sarike/timefly/1.0.0/home/templates/todo_item.tpl",[],'<div class="todo">\n    <h2>\n        <%=todo.todo_name %>\n        <% if(user.is_authenticated && user.self_home){ %>\n            <span class="pull-right">\n                <a href="javascript:void(0)"\n                   class="mark-complete"\n                   title="<% if(todo.todo_is_completed){ %>\n                           撤销已完成状态\n                          <% }else{ %>\n                           设置为已完成\n                          <% } %>">\n                    <i class=" icon-ok"></i>\n                </a>\n                <% if(todo.todo_erasable){ %>\n                    <a href="javascript:void(0)"\n                       class="delete-todo"\n                       title="删除该计划">\n                        <i class=" icon-trash"></i>\n                    </a>\n                <% } %>\n                <a href="javascript:void(0)"\n                   class="change-visible"\n                   title="<% if(todo.todo_visible){ %>\n                             设置为仅对自己可见\n                          <% }else{ %>\n                             设置为对所有人可见\n                          <% } %>">\n                    <i class=" icon-eye-open"></i>\n                </a>\n                <% if(!todo.todo_is_completed){ %>\n                    <a href="javascript:void(0)"\n                       class="add-new-complete"\n                       title="添加新的进度">\n                        <i class="icon-plus"></i>\n                    </a>\n                <% } %>\n            </span>\n        <% } %>\n    </h2>\n    <div class="todo_meta shadow <% if(!todo.todo_visible){ %>todo_private<% } %>">\n        <div class="todo_info">\n            该计划由 <a href="./#<%=todo.user.username%>"> <%=todo.user.nickname || todo.user.username %> </a>\n            开始于  <%=todo.todo_start %> ，计划在\n             <%=todo.todo_end %>  完成！\n        </div>\n        <div class="todo_desc"><%=todo.todo_description %></div>\n    </div>\n\n    <div class="todo_complete">\n        <div class="accordion" id="todo-completes<%=todo.todo_id %>">\n        <% _.each(todo.achievement_list, function(ac, index){ %>\n            <div class="accordion-group">\n                <div class="accordion-heading">\n                    <a class="accordion-toggle" data-toggle="collapse"\n                        data-parent="#todo-completes<%=todo.todo_id %>" href="#collapse<%=ac.id %>">\n                        在 <%=ac.created_date %> <%=ac.ac_name %>\n                    </a>\n                </div>\n                <div id="collapse<%=ac.id %>" class="accordion-body <%if(index==0){ %>in<% } %> collapse ">\n                    <div class="accordion-inner"><%=ac.ac_description %></div>\n                </div>\n            </div>\n        <% }); %>\n        </div>\n    </div>\n</div>'),define("sarike/timefly/1.0.0/home/templates/add_complete_modal.tpl",[],'<div id="acModal">\n    <div>\n        <form id="ac-form" action="todo/add_ac" method="post">\n            <input type="hidden" name="todo_id" value="<%=todo_id %>"/>\n            <label for="id_ac_name">为你这一重大突破起一个响亮的名字</label>\n            <input id="id_ac_name" maxlength="20" name="ac_name" type="text" class="input-block-level">\n            <label for="id_ac_description">描述一下你这次又做了哪些努力</label>\n            <textarea cols="40" id="id_ac_description" name="ac_description" rows="5" class="input-block-level"></textarea>\n        </form>\n    </div>\n</div>');
