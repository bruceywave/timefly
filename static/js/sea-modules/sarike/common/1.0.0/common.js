define("sarike/common/1.0.0/common",["sarike/libs/1.0.0/libs","$","gallery/underscore/1.4.4/underscore","./base/base","gallery/backbone/1.0.0/backbone","./base/templates/common_empty.tpl","./base/templates/common_content.tpl","./base/templates/common_header.tpl","./base/templates/add_todo_modal.tpl","./box/box","./box/templates/user_item.tpl","./box/templates/user_list_box.tpl","./box/templates/about_box.tpl","./box/templates/user_profile_box.tpl","./box/templates/side_nav_box.tpl"],function(a,b,c){a("sarike/libs/1.0.0/libs"),a("$");var d=a("gallery/underscore/1.4.4/underscore"),e=a("./base/base"),f=a("./box/box"),g=function(a,b){b&&(a.sideBar.empty(),d.each(b,function(b){b.collection?(a.sideBar.append(b.render().el),b.collection.fetch({success:function(a){0==a.length&&b.renderEmpty()}})):a.sideBar.append(b.render().el)},this))},h=function(a,b){a.header.html(b.render().el)},i=function(a,b){a.content.html(b.render().el),b.collection&&b.collection.fetch({success:function(a){0==a.length&&b.renderEmpty()}})},j=function(a,b){a.footer.html(b.render().el)};c.exports={Models:e.Models,Collections:e.Collections,Views:e.Views,Box:f,init:function(a,b){h(a,b.header||new e.Views.Header({user:a.user,contentCollection:b.content?b.content.collection:null})),g(a,b.sideBarBoxes),i(a,b.content||new e.Views.Content),j(a,b.footer||new e.Views.Footer)}}}),define("sarike/common/1.0.0/base/base",["sarike/libs/1.0.0/libs","$","gallery/underscore/1.4.4/underscore","gallery/backbone/1.0.0/backbone"],function(a,b,c){var d=a("sarike/libs/1.0.0/libs"),e=a("$"),f=a("gallery/underscore/1.4.4/underscore"),g=a("gallery/backbone/1.0.0/backbone"),h=g.Model.extend({}),i=g.Collection.extend({model:h,parse:function(a){return a.data.items}}),j=g.View.extend({initialize:function(){this.model.bind("change",e.proxy(this.render,this))},render:function(){return this.$el.html(this.template(this.model.toJSON())),this}}),k=g.View.extend({template:f.template(a("sarike/common/1.0.0/base/templates/common_empty.tpl")),render:function(){return this.$el.html(this.template()),this.$el.show(),this},hide:function(){this.$el.hide()}}),l=g.View.extend({itemContainer:null,emptyView:new k,initialize:function(){this.collection?this.collection.bind("add",this.addItem,this):console.warn("No collection!"),this.ItemView=this.ItemView||this.options.ItemView},render:function(){return this.$el.html(this.template()),this},refresh:function(a){this.$el.empty(),this.collection&&this.collection.fetch({success:e.proxy(function(a){0==a.length&&this.renderEmpty()},this),data:a||{}})},renderEmpty:function(){this.$el.html(this.emptyView.render().el)},addItem:function(a){if(this.collection.length>0&&this.emptyView.hide(),!this.ItemView)return console.warn("No ItemView!"),void 0;var b=new this.ItemView({model:a});b.$el.hide(),this.itemContainer?this.$(this.itemContainer).prepend(b.render().el):this.$el.prepend(b.render().el),b.$el.fadeIn()}}),m=g.View.extend({className:""}),n=g.View.extend({className:"box",render:function(){return this.$el.html(this.template(this.model?this.model.toJSON():{})),this}}),o=l.extend({className:"box"}),p=n.extend({has_title:!0,base_template:f.template(a("sarike/common/1.0.0/base/templates/common_content.tpl")),render:function(){return this.renderMainContent(),this.renderSubContent(),this},renderMainContent:function(){this.$el.html(this.base_template({has_title:this.title,title:this.title||this.options.title,sub_title:this.sub_title||this.options.sub_title}))},renderSubContent:function(){this.template&&this.$el.append(this.template(this.options.data))}}),q=o.extend({has_title:!0,base_template:f.template(a("sarike/common/1.0.0/base/templates/common_content.tpl")),render:function(){return this.renderMainContent(),this.renderSubContent(),this},renderMainContent:function(){this.$el.html(this.base_template({has_title:this.title,title:this.title||this.options.title,sub_title:this.sub_title||this.options.sub_title}))},renderSubContent:function(){this.template&&this.$el.append(this.template(this.options.data))},renderEmpty:function(){this.$el.append(this.emptyView.render().el)}}),r=g.View.extend({template:f.template(a("sarike/common/1.0.0/base/templates/common_header.tpl")),events:{"click .add-new-todo":"addNewTodo","click #login-btn":"doLogin","click #reg-btn":"doReg"},doLogin:function(){this.$("#login-form").ajaxSubmit(e.proxy(function(a){if("ok"==a.response){var b=new g.Model(a.data.user);b.set("self_home",this.user.get("self_home")),b.set("at_index_page",this.user.get("at_index_page")),this.user.trigger("login-event",{user:b}),this.user=b,this.render()}else d.Noty.NotyWithRes(a)},this))},doReg:function(){},addNewTodo:function(){var b=a("sarike/common/1.0.0/base/templates/add_todo_modal.tpl"),c=d.JQueryUI.Dialog.extend({template:f.template(b),ok:function(){this.$("#todo-form").submit()},extraRender:function(){var a=this.$("#id_todo_start"),b=this.$("#id_todo_end"),c=this.$("#todo-form");a.datepicker({defaultDate:"+1w",minDate:"+0d",changeYear:!0,onClose:function(a){b.datepicker("option","minDate",a)}}),b.datepicker({defaultDate:"+1w",minDate:"+0d",changeYear:!0,onClose:function(b){a.datepicker("option","maxDate",b)}});var d=this;c.validate({errorClass:"error",submitHandler:function(a){e(a).ajaxSubmit(e.proxy(function(a){this.options.contentCollection&&this.options.contentCollection.add(a.data),this.close()},d))},ignore:"input[type='checkbox']",errorPlacement:function(a,b){b.prev().hide(),b.prev().after(a)},success:function(a){a.prev().show(),a.remove()},rules:{todo_name:{required:!0,maxlength:20},todo_description:{required:!0,maxlength:100},todo_start:{required:!0,date:!0},todo_end:{required:!0,date:!0}},messages:{todo_name:{required:"不响亮不要紧，可不能不填哟",maxlength:jQuery.format("够响亮了，不过不能多于{0}个字符")},todo_description:{required:"该计划到底想完成什么事情呢",maxlength:jQuery.format("不过不能多于{0}个字符")},todo_start:{required:"记得为该计划设定一个起始时间哟",date:"我要的是日期，你输入的是火星文吗？"},todo_end:{required:"记得为该计划设定一个结束时间哟",date:"我要的是日期，你输入的是火星文吗？"}}})}}),g=new c({contentCollection:this.options.contentCollection});g.open({height:480,width:310,modal:!0,title:"制定一个新的计划",resizable:!1})},initialize:function(){this.options.user?this.user=this.options.user:console.warn("you should pass a user obj when init header")},render:function(){return this.$el.html(this.template({user:this.user.toJSON()})),this}}),s=g.View.extend({});c.exports={Models:{BaseModel:h},Collections:{BaseCollection:i},Views:{Item:j,ItemsContainer:l,EmptyView:k,ObjectBox:n,ArrayBox:o,PlainBox:m,Content:q,ObjectContent:p,Header:r,Footer:s}}}),define("sarike/common/1.0.0/base/templates/common_empty.tpl",[],'<div class="box">啥玩意儿都木有……</div>'),define("sarike/common/1.0.0/base/templates/common_content.tpl",[],'<div class="box-header">\n    <% if(has_title){ %>\n    <h2><%=title || "No Title" %></h2>\n    <p class="box-subheader"><%=sub_title || "No Sub_title" %></p>\n    <% } %>\n</div>'),define("sarike/common/1.0.0/base/templates/common_header.tpl",[],'<div class="navbar navbar-fixed-top">\n    <div class="navbar-inner">\n        <div class="container">\n            <ul class="nav">\n                <li <% if(user.at_index_page){ %>class="active"<% } %>>\n                    <a href="#" class=" clearfix">\n                        <span><i class="nav-home"></i></span>\n                        <span>主页</span>\n                    </a>\n                </li>\n                <% if(!!user && user.is_authenticated){ %>\n                <li <% if(user.self_home){ %>class="active"<% } %>>\n                    <a href="#<%=user.username %>" class=" clearfix">\n                        <span><i class="nav-me"></i></span>\n                        <span>我</span>\n                    </a>\n                </li>\n                <% } %>\n            </ul>\n\n            <div class="pull-right">\n                <% if(!!user && user.is_authenticated){ %>\n                <ul class="nav">\n                    <li>\n                        <a href="#" class=" clearfix dropdown-toggle" data-toggle="dropdown">\n									<span>\n                                        <%=user.nickname || user.username %>\n									</span>\n									<span>\n										<i class="caret"></i>\n									</span>\n                        </a>\n                        <ul class="dropdown-menu" role="menu" aria-labelledby="">\n                            <li role="presentation">\n                                <a role="menuitem" tabindex="-1" href="#<%= user.username %>/setting">\n                                    <i class="icon-user "></i> 个人资料\n                                </a>\n                            </li>\n                            <li role="presentation" class="divider"></li>\n                            <li role="presentation">\n                                <a role="menuitem" tabindex="-1" href="../account/logout">\n                                    <i class="icon-off"></i> 退出登录</a></li>\n                        </ul>\n                    </li>\n                </ul>\n                <button title="制定新计划" class="add-new-todo btn btn-info">\n                    <i class="nav-new-todo"></i><span></span>\n                </button>\n                <% }else{ %>\n                <form id="login-form" class="form-inline" action="account/ajax_login" method="post">\n                    <input type="text" name="email" class="input-medium" placeholder="Email">\n                    <input type="password" name="password" class="input-medium" placeholder="Password">\n                    <label class="checkbox">\n                        <input type="checkbox" name="remember"> 记住我\n                    </label>\n                    <button type="button" id="login-btn" class="btn btn-info">登录</button>\n                    <button class="btn btn-info" type="button" onclick="javascript:location.href=\'account/reg\'">注册\n                    </button>\n                </form>\n                <% } %>\n            </div>\n        </div>\n    </div>\n</div>'),define("sarike/common/1.0.0/base/templates/add_todo_modal.tpl",[],'<div id="todoModal" class="">\n    <div>\n        <form id="todo-form" action="todo/add_todo" method="post">\n            <label for="id_todo_name">为你的新计划起一个响亮的名字</label>\n            <input type="text" class="input-block-level" id="id_todo_name" name="todo_name"/>\n            <label for="id_todo_description">描述一下该计划打算要完成的事情</label>\n            <textarea rows="5" class="input-block-level" id="id_todo_description" name="todo_description"></textarea>\n            <label for="id_todo_start">你打算什么时候开始这个计划？</label>\n            <input type="text" class="input-block-level" id="id_todo_start" name="todo_start" value=""/>\n            <label for="id_todo_end">这个计划你预计会在什么时候完成呢？</label>\n            <input type="text" class="input-block-level" id="id_todo_end" name="todo_end" value=""/>\n            <ul>\n                <li class="checkbox"><input type="checkbox" name="todo_visible"/>对所有人可见</li>\n                <li class="checkbox"><input type="checkbox" name="todo_erasable"/> 不可删除</li>\n            </ul>\n        </form>\n    </div>\n</div>'),define("sarike/common/1.0.0/box/box",["sarike/libs/1.0.0/libs","$","gallery/underscore/1.4.4/underscore","sarike/common/1.0.0/base/base","gallery/backbone/1.0.0/backbone"],function(a,b,c){a("sarike/libs/1.0.0/libs");var d=a("$"),e=a("gallery/underscore/1.4.4/underscore"),f=a("sarike/common/1.0.0/base/base"),g=f.Views.Item.extend({template:e.template(a("sarike/common/1.0.0/box/templates/user_item.tpl")),tagName:"li",className:"media"}),h=f.Views.ArrayBox.extend({template:e.template(a("sarike/common/1.0.0/box/templates/user_list_box.tpl")),ItemView:g,itemContainer:".media-list"}),i=f.Views.ObjectBox.extend({template:e.template(a("sarike/common/1.0.0/box/templates/about_box.tpl"))}),j=f.Views.ObjectBox.extend({template:e.template(a("sarike/common/1.0.0/box/templates/user_profile_box.tpl"))}),k=f.Views.PlainBox.extend({template:e.template(a("sarike/common/1.0.0/box/templates/side_nav_box.tpl")),events:{"click .nav-list>li":"clickNavItem"},clickNavItem:function(a){var b=d(a.currentTarget);this.$("li").removeClass("active"),b.addClass("active"),this.action(b)},action:function(){},render:function(){return this.$el.html(this.template({side_nav_list:this.side_nav_list||this.options.side_nav_list||[]})),this}});c.exports={UserBox:h,AboutBox:i,UserProfileBox:j,SideNavBox:k}}),define("sarike/common/1.0.0/box/templates/user_item.tpl",[],'<a class="pull-left" href="./#<%=username %>"> <img\n        class="media-object img-rounded"\n        src="http://www.gravatar.com/avatar/<%=avatar_hash %>?d=identicon"\n        class="img-rounded" alt="Avatar">\n</a>\n\n<div class="media-body">\n    <h4 class="media-heading">\n        <a href="./#<%=username %>">\n            <%=nickname %>\n        </a>\n    </h4>\n    Description\n</div>'),define("sarike/common/1.0.0/box/templates/user_list_box.tpl",[],'<div id="friend-list">\n    <h3>\n        活跃用户 <a href="#">查看全部</a>\n    </h3>\n    <ul class="media-list">\n    </ul>\n</div>'),define("sarike/common/1.0.0/box/templates/about_box.tpl",[],'<span class="copyright">&copy; 2013</span> <a href="#">关于</a>'),define("sarike/common/1.0.0/box/templates/user_profile_box.tpl",[],'<div id="user-profile">\n        <div class="clearfix">\n            <div id="avatar" class="pull-left">\n                <img src="http://www.gravatar.com/avatar/<%=avatar_hash %>?d=identicon" class="img-rounded" alt="Avatar">\n            </div>\n            <div id="user-info" class="pull-left">\n                <h2>\n                    <%=nickname %>\n                </h2>\n                <ul>\n                    <li>努力中 <span class="badge badge-info"><%=ing_count %></span></li>\n                    <li>已完成 <span class="badge badge-success"><%=ed_count %></span></li>\n                    <li>未完成 <span class="badge badge-important"><%=fail_count %></span></li>\n                </ul>\n            </div>\n        </div>\n        <div id="user-desc"><%=description %></div>\n</div>'),define("sarike/common/1.0.0/box/templates/side_nav_box.tpl",[],'<div id="menu">\n    <ul class="nav nav-list">\n        <% _.each(side_nav_list, function(nav){ %>\n        <li data-id="<%=nav.id %>" <% if(nav.active){ %>class="active"<% } %>>\n            <a href="javascript: void(0)"><%=nav.caption %><i class="icon-chevron-right pull-right"></i></a>\n        </li>\n        <% });%>\n    </ul>\n</div>');
