{% extends "todo/base.html" %}
{% block sidebar %}
<div id="friend-list" class="box">
	<h3>
		活跃用户 <a href="#">查看全部</a>
	</h3>
	<ul class="media-list">
	{%for user in user_list%}
		<li class="media"><a class="pull-left" href="#"> <img
				class="media-object img-rounded"
				src="http://www.gravatar.com/avatar/{{user.get_gravatar_hash()}}?d=identicon"
				class="img-rounded" alt="Avatar">
		</a>
			<div class="media-body">
				<h4 class="media-heading"><a href="{{request.host_url}}{{user.username}}">
												{%if user.nickname %}
													{{ user.nickname }}
												{%else%}
													{{ user.username }}
												{%endif%}
												</a></h4>
				{{user.description}}
			</div></li>
	{%endfor%}
	</ul>
</div>
{{ super() }}
{% endblock%}
{% block content %}	
<div class="box">
	<div class="box-header">
		<h2>最新计划</h2>
		<p class="box-subheader">时光飞逝网友发布的最新计划</p>
	</div>
	{%for todo in todo_list%}
		<div class="media">
		  <a class="pull-left" href="http://{{request.host_url}}{{todo.user.username}}">
		    <img class="media-object img-rounded"
                 src="http://www.gravatar.com/avatar/{{todo.user.get_gravatar_hash()}}?d=identicon">
		  </a>
		  <div class="media-body" style="font-size:14px;line-height: 20px;">
		    <h4 class="media-heading">{{todo.todo_name}}</h4>
		    该计划由 <a href="./{{todo.user.username}}">{%if todo.user.nickname%}
													{{todo.user.nickname}}
												{%else%}
													{{todo.user.username}}
												{%endif%}
												</a> 开始于  {{todo.todo_start}} ，计划在
				 {{todo.todo_end}}  完成！
				 <br>
		    {{todo.todo_description}}
		  </div>
		</div>
	{%endfor%}
</div>
{% endblock %}
{%block extrajs%}
 		{{ super() }}
					<script type="text/javascript">
					
					$(function(){
						$('body').tooltip({
							selector: "button[data-trigger=tooltip]"
						});
						$('.add-new-todo').click(function(){
					    	$('#todoModal').dialog({
					    		height: 480,
					    		width: 310,
					    		modal: true,
					    		title:"制定一个新的计划",
					    		resizable: false,
					    		buttons: {
					    			保存: function() {
					    				$("#todo-form").submit();
					    			},
					    			取消: function() {
					    				$( this ).dialog( "close" );
					    			}
					    		},
					    		open: function( event, ui ) {
					    			$(this).find("input[type=text],textarea").addClass("input-block-level");
					    		}
					    	});
					    });
						

						$.datepicker.setDefaults({
							autoSize:true,
							showAnim:"slideDown",
							dateFormat:"yy-mm-dd",
							closeText: '关闭',
							prevText: '&#x3C;上月',
							nextText: '下月&#x3E;',
							currentText: '今天',
							monthNames: ['一月','二月','三月','四月','五月','六月',
							'七月','八月','九月','十月','十一月','十二月'],
							monthNamesShort: ['一月','二月','三月','四月','五月','六月',
							'七月','八月','九月','十月','十一月','十二月'],
							dayNames: ['星期日','星期一','星期二','星期三','星期四','星期五','星期六'],
							dayNamesShort: ['周日','周一','周二','周三','周四','周五','周六'],
							dayNamesMin: ['日','一','二','三','四','五','六'],
							weekHeader: '周',
							dateFormat: 'yy-mm-dd',
							firstDay: 1,
							isRTL: false,
							showMonthAfterYear: true,
							yearSuffix: '年'
						});
						$( "#id_todo_start" ).datepicker({
							defaultDate: "+1w",
							minDate:"+0d",
			                changeYear: true,
			                onClose: function( selectedDate ) {
			                	$( "#id_todo_end" ).datepicker( "option", "minDate", selectedDate );
			                }
			            });
						$( "#id_todo_end" ).datepicker({
							defaultDate: "+1w",
			                changeYear: true,
			                minDate:"+0d",
			                onClose: function( selectedDate ) {
			                	$( "#id_todo_start" ).datepicker( "option", "maxDate", selectedDate );
			                }
			            });

						$("#todo-form").validate(
						{
							errorClass: "error",
							ignore: "input[type='checkbox']",
							errorPlacement: function(error, element) {
								element.prev().hide();
								element.prev().after(error);
							},
							success:function(label){
								label.prev().show();
								label.remove();
							},
							rules: {
								todo_name: {
									required:true,
									maxlength: 20
								},
								todo_description: {
									required:true,
									maxlength: 100
								},
								todo_start: {
									required: true,
									date: true
								},
								todo_end: {
									required: true,
									date: true
								}
							},
							messages: {
								todo_name: {
									required: "不响亮不要紧，可不能不填哟",
									maxlength: jQuery.format("够响亮了，不过不能多于{0}个字符")
								},
								todo_description: {
									required: "该计划到底想完成什么事情呢",
									maxlength: jQuery.format("不过不能多于{0}个字符")
								},
								todo_start: {
									required: "记得为该计划设定一个起始时间哟",
									date: "我要的是日期，你输入的是火星文吗？"
								},
								todo_end: {
									required: "记得为该计划设定一个结束时间哟",
									date: "我要的是日期，你输入的是火星文吗？"
								}
							}
						});
						$("#ac-form").validate(
						{
							errorClass: "error",
							ignore: "input[type='checkbox']",
							errorPlacement: function(error, element) {
								element.prev().hide();
								element.prev().after(error);
							},
							success:function(label){
								label.prev().show();
								label.remove();
							},
							rules: {
								ac_name: {
									required:true,
									maxlength: 20
								},
								ac_description: {
									required:true,
									maxlength: 100
								}
							},
							messages: {
								ac_name: {
									required: "不响亮不要紧，可不能不填哟",
									maxlength: jQuery.format("够响亮了，不过不能多于{0}个字符")
								},
								ac_description: {
									required: "你到底是完成了什么呢？",
									maxlength: jQuery.format("不过不能多于{0}个字符")
								}
							}
						});
});
</script>
	{% endblock %}

