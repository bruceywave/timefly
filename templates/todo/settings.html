{% extends "base.html" %} 
{%block extrastyle%}
	{{block.super}}
	<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
{%endblock%}
		{% block sidebar %}
								
								<div id="menu">
									<ul class="nav nav-list">
										<li{%if tabname == 'userinfo'%} class="active"{%endif%}><a href="Setting/userinfo/">个人资料<i class="icon-chevron-right pull-right"></i></a></li>
										<!-- <li><a href="Setting/emailremind/">邮件提醒<i class="icon-chevron-right pull-right"></i></a></li> -->
										<li{%if tabname == 'alterpwd'%} class="active"{%endif%}><a href="Setting/alterpwd/">密码修改<i class="icon-chevron-right pull-right"></i></a></li>
									</ul>
								</div>
								{{ block.super }}
		{% endblock %}
			
		{% block content %}	
								<div id="user-profile" class="box text-center">
									{%if tabname == "userinfo"%}
									<div class="clearfix">
										<div id="avatar" class="">
											<img src="http://www.gravatar.com/avatar/{{user.userprofile.get_gravatar_hash}}?d=identicon" class="img-rounded" alt="Avatar">
										</div>
										<div id="user-info" class="">
											<h2>{%if user.first_name%}
													{{user.first_name}}
												{%else%}
													{{user.username}}
												{%endif%}</h2>
											<!-- <ul class="inline">
												<li>努力中 <span class="badge badge-info">8</span></li>
												<li>已完成 <span class="badge badge-success">2</span></li>
												<li>未完成 <span class="badge badge-important">6</span></li>
											</ul> -->	

										</div>
									</div>
									<div id="user-desc">{{user.userprofile.description}}</div>
									<div class="alert">
										修改个人头像请到：<a target="blank" href="http://en.gravatar.com/">Gravatar</a>
									</div>
									<hr>
									<!--****************************个人资料设置********************************-->
									{% if messages %}		
										{% for message in messages %}
											<div class="alert alert-{{message.tags}}">
											  <button type="button" class="close" data-dismiss="alert">&times;</button>
												<div class="text-center">
												    {{ message }}
												</div>
											</div>
										{% endfor %}
									{% endif %}
									<form class="form-horizontal text-left" method="post" action="Setting/userinfo/">
									{%csrf_token%}
										
										<div class="control-group">
											<label class="control-label" for="inputPassword">邮箱地址</label>
											<div class="controls">
												{{user_form.email}}
												<span class="label label-info">{{user_form.email.errors}}</span>
												<span class="help-block">（不公开显示）你可以用该邮箱来登录 TimeFly 以及接收邮件提醒</span>
											</div>
										</div>
										<div class="control-group">
											<label class="control-label" for="inputEmail">用户名</label>
											<div class="controls">
												{{user_form.username}}
												<span class="label label-info">{{user_form.username.errors}}</span>
												<span class="help-block">您的主页地址 http://www.timefly.cn/{{user_form.username.value}}</span>
											</div>
										</div>
										<div class="control-group">
											<label class="control-label" for="inputEmail">昵称</label>
											<div class="controls">
												{{user_form.first_name}}
												<span class="label label-info">{{user_form.first_name.errors}}</span>
												<span class="help-block">可以是你的真实姓名，或者是一个响亮的称号,最长为4个字符</span>
											</div>
										</div>
										<div class="control-group">
											<label class="control-label" for="inputPassword">个人描述</label>
											<div class="controls">
												{{form.description}}
												<span class="label label-info">{{form.description.errors}}</span>
												<span class="help-block">简单说一下你自己，写出你自己的奋斗宣言</span>
											</div>
										</div>
										<div class="control-group">
											<div class="controls">
												<button type="submit" class="btn btn-info">保存更改</button>
											</div>
										</div>
									</form>
									<!--************************************************************-->
									{%endif%}
									{%if tabname == "alterpwd"%}
									<!--****************************密码修改********************************-->
									<div class="box-header">
										<h2>修改密码</h2>
										<p class="box-subheader">更换一个新的密码</p>
									</div>
							{% if messages %}		
							{% for message in messages %}
									<div class="alert alert-{{message.tags}}">
									  <button type="button" class="close" data-dismiss="alert">&times;</button>
										<div class="text-center">
										    {{ message }}
										</div>
									</div>
									{% endfor %}
							{% endif %}
									<form class="form-horizontal text-left" method="post">
									{%csrf_token%}
										<div class="control-group">
											<label class="control-label" for="inputEmail">原始密码</label>
											<div class="controls">
												{{form.old_password}}
												<span class="inline label label-important">{{form.old_password.errors}}</span>
												<!-- <span class="help-block"><a href="#">你竟然把密码给忘记了？</a></span> -->
											</div>
										</div>
										<div class="control-group">
											<label class="control-label" for="inputEmail">新密码</label>
											<div class="controls">
											{{form.new_password}}
											<span class="inline label label-important">{{form.new_password.errors}}</span>
											</div>
										</div>
										<div class="control-group">
											<label class="control-label" for="inputEmail">确认密码</label>
											<div class="controls">
												{{form.new_password_confirm}}
												<span class="inline label label-important">{{form.new_password_confirm.errors}}</span>
											</div>
										</div>
										<div class="control-group">
											<div class="controls">
												<button type="submit" class="btn btn-info">保存更改</button>
											</div>
										</div>
									</form>
									<!--************************************************************-->
									{%endif%}
									{%if tabname == "emailremind"%}
									<!--****************************邮件提醒********************************-->
									<div class="box-header">
										<h2>邮件提醒设置</h2>
										<p class="box-subheader">告诉我在什么时候该发邮件提醒你</p>
									</div>
									<form class="form-horizontal text-left">
										<div class="control-group">
											<div class="controls">
												<label class="checkbox">
												<input type="checkbox"> 当有人评论我的计划的时候
											</label>

											</div>
										</div>
										<div class="control-group">
											<div class="controls">
												<label class="checkbox">
												<input type="checkbox"> 当有人关注我的时候
											</label>

											</div>
										</div>
										<div class="control-group">
											<div class="controls">
												<label class="checkbox">
												<input type="checkbox"> 当我的某个计划开始的时候
											</label>

											</div>
										</div>
										<div class="control-group">
											<div class="controls">
												<label class="checkbox">
												<input type="checkbox"> 当我的某个计划还有一天就要结束的时候
											</label>

											</div>
										</div>
										<div class="control-group">
											<div class="controls">
												<button type="submit" class="btn btn-info">保存更改</button>
											</div>
										</div>

									</form>
									<!--************************************************************-->
									{%endif%}
								</div>
		{% endblock %}
	
	{%block extrajs%}
 		{{ block.super }}
					<script type="text/javascript">
					$(function(){
						
						$('body').tooltip({
							selector: "button[data-trigger=tooltip]"
						});
						$('.add-new-todo').click(function(){
					    	$('#todoModal').dialog({
					    		height: 480,
					    		width: 310,
					    		modal: true,
					    		title:"制定一个新的计划",
					    		resizable: false,
					    		buttons: {
					    			保存: function() {
					    				$("#todo-form").submit();
					    			},
					    			取消: function() {
					    				$( this ).dialog( "close" );
					    			}
					    		},
					    		open: function( event, ui ) {
					    			$(this).find("input[type=text],textarea").addClass("input-block-level");
					    		}
					    	});
					    });
						$('.add-new-complete').click(function(){
					    	var todoid = $( this ).data("todoid");
					    	console.info($( this ));
					    	console.info("todoid:"+todoid);
					    	$('#acModal').dialog({
					    		height: 335,
					    		width: 300,
					    		modal: true,
					    		title:"制定一个新的计划",
					    		resizable: false,
					    		buttons: {
					    			保存: function() {
					    				$(this).find("input[name='todoid']").val(todoid);
					    				$("#ac-form").submit();
					    			},
					    			取消: function() {
					    				$( this ).dialog( "close" );
					    			}
					    		},
					    		open: function( event, ui ) {
					    			$(this).find("input[type=text],textarea").addClass("input-block-level");
					    		}
					    	});
					    });

						$.datepicker.setDefaults({
							autoSize:true,
							showAnim:"slideDown",
							dateFormat:"yy-mm-dd",
							closeText: '关闭',
							prevText: '&#x3C;上月',
							nextText: '下月&#x3E;',
							currentText: '今天',
							monthNames: ['一月','二月','三月','四月','五月','六月',
							'七月','八月','九月','十月','十一月','十二月'],
							monthNamesShort: ['一月','二月','三月','四月','五月','六月',
							'七月','八月','九月','十月','十一月','十二月'],
							dayNames: ['星期日','星期一','星期二','星期三','星期四','星期五','星期六'],
							dayNamesShort: ['周日','周一','周二','周三','周四','周五','周六'],
							dayNamesMin: ['日','一','二','三','四','五','六'],
							weekHeader: '周',
							dateFormat: 'yy-mm-dd',
							firstDay: 1,
							isRTL: false,
							showMonthAfterYear: true,
							yearSuffix: '年'
						});
						$( "#id_todo_start" ).datepicker({
							defaultDate: "+1w",
							minDate:"+0d",
			                changeYear: true,
			                onClose: function( selectedDate ) {
			                	$( "#id_todo_end" ).datepicker( "option", "minDate", selectedDate );
			                }
			            });
						$( "#id_todo_end" ).datepicker({
							defaultDate: "+1w",
			                changeYear: true,
			                minDate:"+0d",
			                onClose: function( selectedDate ) {
			                	$( "#id_todo_start" ).datepicker( "option", "maxDate", selectedDate );
			                }
			            });

						$("#todo-form").validate(
						{
							errorClass: "error",
							ignore: "input[type='checkbox']",
							errorPlacement: function(error, element) {
								element.prev().hide();
								element.prev().after(error);
							},
							success:function(label){
								label.prev().show();
								label.remove();
							},
							rules: {
								todo_name: {
									required:true,
									maxlength: 20
								},
								todo_description: {
									required:true,
									maxlength: 100
								},
								todo_start: {
									required: true,
									date: true
								},
								todo_end: {
									required: true,
									date: true
								}
							},
							messages: {
								todo_name: {
									required: "不响亮不要紧，可不能不填哟",
									maxlength: jQuery.format("够响亮了，不过不能多于{0}个字符")
								},
								todo_description: {
									required: "该计划到底想完成什么事情呢",
									maxlength: jQuery.format("不过不能多于{0}个字符")
								},
								todo_start: {
									required: "记得为该计划设定一个起始时间哟",
									date: "我要的是日期，你输入的是火星文吗？"
								},
								todo_end: {
									required: "记得为该计划设定一个结束时间哟",
									date: "我要的是日期，你输入的是火星文吗？"
								}
							}
						});
						$("#ac-form").validate(
						{
							errorClass: "error",
							ignore: "input[type='checkbox']",
							errorPlacement: function(error, element) {
								element.prev().hide();
								element.prev().after(error);
							},
							success:function(label){
								label.prev().show();
								label.remove();
							},
							rules: {
								ac_name: {
									required:true,
									maxlength: 20
								},
								ac_description: {
									required:true,
									maxlength: 100
								}
							},
							messages: {
								ac_name: {
									required: "不响亮不要紧，可不能不填哟",
									maxlength: jQuery.format("够响亮了，不过不能多于{0}个字符")
								},
								ac_description: {
									required: "你到底是完成了什么呢？",
									maxlength: jQuery.format("不过不能多于{0}个字符")
								},
							}
						});
});
</script>
	{% endblock %}